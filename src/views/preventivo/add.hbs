<div class="container p-2  mb-4">
    <div class="row">
        <div class="col-md-8 mx-auto py-4">
            <div class="card pb-4">
                <div class="card-header text-center">
                    <h2> Crear un nuevo Preventivo</h2>
                </div>
                <div class="card-body pb-2">
                    <form action="/mantenimientopreventivo/add" method="POST" enctype="multipart/form-data">
                        <input class="form-control" type="hidden" name="created_by_id" placeholder="created_by_id"
                            value="{{user.id}}" />
                        <div class="form-group" style="position: relative;">
                            <label for="item">AtoN NIF</label>
                            <input id="nifInput" class="form-control" type="text" name="nif" placeholder="nif" 
                                {{#if nif}} value="{{nif}}" {{/if}} required/>
                                <ul id="sugerencias" class="sugerencias-lista"></ul>
                        </div>
                                     <div class="form-group">
                            <label for="item">Fecha revisión</label>
                            <input class="form-control" type="date" name="fecha" placeholder="fecha" required/>
                        </div>
                        {{>preventivo}}
                        <div class="form-group">
                            <button class="btn btn-primary btn-block mt-3 w-100">GRABAR PREVENTIVO</button>
                        </div>
                    </form>
                </div>
                <a class="btn btn-secondary mx-3" onclick="history.back();">Cancelar</a>
            </div>
        </div>
    </div>
</div>

<script>
const input = document.getElementById('nifInput');
const lista = document.getElementById('sugerencias');

input.addEventListener('input', async () => {
  const termino = input.value.trim();
  lista.innerHTML = '';

  if (termino.length < 2) return;

  try {
    const res = await fetch(`/api/autocompletar-nif?termino=${termino}`);
    const datos = await res.json();
    console.log("DATOS:",datos);

    datos.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.nif} - ${item.tipo}`;
      li.addEventListener('click', () => {
        input.value = item.nif;
        lista.innerHTML = ''; // limpia sugerencias
        //completarDatos(item); // función para rellenar otros campos
      });
      lista.appendChild(li);
    });
  } catch (err) {
    console.error('Error al autocompletar:', err);
  }
});

function completarDatos(cliente) {
  // Aquí rellenas los otros campos del formulario
  document.getElementById('nombre').value = cliente.nombre;
  document.getElementById('direccion').value = cliente.direccion;
}


</script>